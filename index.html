<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Calculadora de interés compuesto</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0e1117"/>
  <style>
    :root{--bg:#0e1117;--panel:#151a24;--muted:#aab3c5;--accent:#20c997;--accent2:#4dabf7;--text:#e9edf3;--border:#1f2633}
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial;background:var(--bg);color:var(--text)}
    header{padding:22px 18px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center}
    h1{font-size:1.25rem;margin:0}
    .wrap{display:grid;grid-template-columns:340px 1fr;gap:18px;padding:18px;max-width:1400px;margin:0 auto}
    .card{background:var(--panel);border:1px solid var(--border);border-radius:12px;padding:16px}
    label{display:block;font-size:.85rem;color:var(--muted);margin:10px 0 6px 2px}
    input,select{width:100%;padding:10px 12px;border-radius:10px;border:1px solid #293142;background:#0f1420;color:var(--text);outline:none}
    input:focus,select:focus{border-color:#3a485f}
    .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .btn{background:#1b2332;border:1px solid #2a374e;color:var(--text);padding:10px 12px;border-radius:10px;cursor:pointer}
    .btn:hover{filter:brightness(1.1)}
    .results{display:grid;grid-template-columns:repeat(4,minmax(160px,1fr));gap:12px}
    .pill{background:#0f1420;border:1px solid #233049;border-radius:12px;padding:12px}
    .pill h3{margin:0 0 6px 0;font-size:.85rem;color:var(--muted)}
    .pill .val{font-size:1.2rem;font-variant-numeric:tabular-nums}
    .chart{height:320px;display:flex;align-items:flex-end;gap:24px;padding:12px 8px 8px;border-radius:12px;background:#0f1420;border:1px solid #233049}
    .bar{width:68px;display:flex;flex-direction:column;justify-content:flex-end}
    .bar-stack{display:flex;flex-direction:column;width:100%;border-radius:8px;overflow:hidden}
    .seg{width:100%}
    .seg.initial{background:var(--accent2)}
    .seg.contributions{background:#9ad0ff33;border-top:1px solid #2f5b8e}
    .seg.interest{background:var(--accent)}
    .bar-label{margin-top:8px;text-align:center;color:var(--muted);font-size:.85rem}
    table{width:100%;border-collapse:collapse}
    th,td{padding:8px 10px;border-bottom:1px solid #223046;font-variant-numeric:tabular-nums}
    th{color:var(--muted);text-align:left;font-weight:600}
    .muted{color:var(--muted)}
    .toggle{appearance:none;width:48px;height:28px;border-radius:14px;background:#263247;position:relative;cursor:pointer;border:1px solid #394964}
    .toggle:checked{background:#2a8f67}
    .toggle::after{content:"";position:absolute;top:2px;left:2px;width:22px;height:22px;border-radius:50%;background:#e9edf3;transition:transform .2s}
    .toggle:checked::after{transform:translateX(20px)}
    @media (max-width: 980px){.wrap{grid-template-columns:1fr}.results{grid-template-columns:1fr 1fr}}
    .light{--bg:#f6f7fb;--panel:#ffffff;--text:#0e1117;--muted:#5b6578;--border:#e6e9f2}
  </style>
</head>
<body>
  <header>
    <h1>Calculadora de interés compuesto</h1>
    <div class="row">
      <span class="muted">Tema claro</span>
      <input id="theme" class="toggle" type="checkbox" aria-label="Cambiar tema">
      <button class="btn" id="instalar" style="display:none">Instalar</button>
    </div>
  </header>

  <main class="wrap">
    <section class="card">
      <div class="grid">
        <div><label for="moneda">Moneda / símbolo</label><input id="moneda" value="$"></div>
        <div><label for="deposito">Depósito inicial</label><input id="deposito" type="number" inputmode="decimal" min="0" step="0.01" value="1000"></div>
      </div>
      <div class="grid">
        <div><label for="tasa">Tasa anual (%)</label><input id="tasa" type="number" inputmode="decimal" min="0" step="0.01" value="10"></div>
        <div><label for="anios">Años</label><input id="anios" type="number" min="0" step="1" value="10"></div>
      </div>
      <div class="grid">
        <div>
          <label for="freq">Capitalización</label>
          <select id="freq">
            <option value="ANNUAL">Anual</option>
            <option value="SEMIANNUAL">Semestral</option>
            <option value="QUARTERLY">Trimestral</option>
            <option value="MONTHLY" selected>Mensual</option>
            <option value="BIWEEKLY">Quincenal</option>
            <option value="WEEKLY">Semanal</option>
            <option value="DAILY">Diaria (365)</option>
          </select>
        </div>
        <div><label for="aporte">Aportación por periodo</label><input id="aporte" type="number" inputmode="decimal" min="0" step="0.01" value="100"></div>
      </div>
      <div class="row" style="margin-top:12px">
        <button class="btn" id="guardar">Guardar config</button>
        <button class="btn" id="ejemplo">Ejemplo (0 inicial, 100/mes, 12%, 20y)</button>
      </div>
      <p class="muted" style="margin-top:8px">Aportaciones al final de cada periodo, reinvertidas.</p>
    </section>
    <section class="card">
<div style="display:flex; gap:14px; font-size:.85rem; margin-bottom:14px; color:var(--muted)">
  <div style="display:flex;align-items:center;gap:6px">
    <div style="width:14px;height:14px;background:var(--accent2);border-radius:3px"></div>
    <span>Depósito inicial</span>
  </div>
  <div style="display:flex;align-items:center;gap:6px">
    <div style="width:14px;height:14px;background:#9ad0ff33;border:1px solid #2f5b8e;border-radius:3px"></div>
    <span>Aportes adicionales</span>
  </div>
  <div style="display:flex;align-items:center;gap:6px">
    <div style="width:14px;height:14px;background:var(--accent);border-radius:3px"></div>
    <span>Interés acumulado</span>
    </div> <!-- cierre del bloque de leyenda -->

<div id="chart" class="chart"></div>
  </div>
</div>
      <div class="results" style="margin-top:14px">
        <div class="pill"><h3>Depósito inicial</h3><div class="val" id="rInicial">$0.00</div></div>
        <div class="pill"><h3>Depósitos adicionales</h3><div class="val" id="rAportes">$0.00</div></div>
        <div class="pill"><h3>Interés acumulado</h3><div class="val" id="rInteres">$0.00</div></div>
        <div class="pill"><h3>Total</h3><div class="val" id="rTotal">$0.00</div></div>
      </div>
      <div class="row" style="margin:14px 0"><span id="resumen" class="muted"></span></div>
      <div style="max-height:360px;overflow:auto;border:1px solid #233049;border-radius:10px">
        <table>
          <thead><tr><th>Año</th><th>Saldo inicial</th><th>Interés del año</th><th>Aportes del año</th><th>Saldo final</th></tr></thead>
          <tbody id="tbody"></tbody>
        </table>
      </div>
    </section>
  </main>

<script>
  // SW
  if ('serviceWorker' in navigator){ window.addEventListener('load', ()=> navigator.serviceWorker.register('sw.js')); }
  let deferredPrompt; const btn=document.getElementById('instalar');
  window.addEventListener('beforeinstallprompt', (e)=>{ e.preventDefault(); deferredPrompt=e; btn.style.display='inline-block'; });
  btn?.addEventListener('click', async ()=>{ if(!deferredPrompt) return; deferredPrompt.prompt(); await deferredPrompt.userChoice; deferredPrompt=null; btn.style.display='none'; });

  const $ = id=>document.getElementById(id);
  const perYear = {ANNUAL:1,SEMIANNUAL:2,QUARTERLY:4,MONTHLY:12,BIWEEKLY:24,WEEKLY:52,DAILY:365};

  function compute({principal,rateAnnual,years,freq,contrib}){
    const n=perYear[freq], r=rateAnnual/100, i=r/n, periods=Math.round(years*n);
    let balance=principal, totalContrib=0, totalInterest=0;
    const yearly=[]; let yearStart=balance, interestYear=0, contribYear=0, y=1;
    for(let p=1;p<=periods;p++){
      const before=balance; balance*=(1+i); const intThis=balance-before; totalInterest+=intThis; interestYear+=intThis;
      if(contrib>0){ balance+=contrib; totalContrib+=contrib; contribYear+=contrib; }
      if(p % n===0){ yearly.push({year:y,start:yearStart,interest:interestYear,contrib:contribYear,end:balance}); y++; yearStart=balance; interestYear=0; contribYear=0; }
    }
    if(periods===0){ yearly.push({year:1,start:principal,interest:0,contrib:0,end:principal}); }
    return {principal,totalContrib,totalInterest,total:balance,yearly};
  }

  function m(sym,v){ return sym + (v.toLocaleString('es-MX',{minimumFractionDigits:2,maximumFractionDigits:2})); }

  function renderBars(sym,parts){
    const chart=$('chart'); chart.innerHTML='';
    const total=parts.initial+parts.contrib+parts.interest; const H=280, scale = total>0 ? H/total : 0;
    const bar=document.createElement('div'); bar.className='bar';
    const stack=document.createElement('div'); stack.className='bar-stack';
    const a=document.createElement('div'); a.className='seg interest'; a.style.height=(parts.interest*scale)+'px';
    const b=document.createElement('div'); b.className='seg contributions'; b.style.height=(parts.contrib*scale)+'px';
    const c=document.createElement('div'); c.className='seg initial'; c.style.height=(parts.initial*scale)+'px';
    stack.append(a,b,c); bar.append(stack); const lab=document.createElement('div'); lab.className='bar-label'; lab.textContent=parts.label; bar.append(lab); chart.append(bar);
  }

  function update(){
    const sym=$('moneda').value||'$'; const principal=parseFloat($('deposito').value||0);
    const rate=parseFloat($('tasa').value||0); const years=parseFloat($('anios').value||0);
    const freq=$('freq').value; const contrib=parseFloat($('aporte').value||0);
    const res=compute({principal,rateAnnual:rate,years,freq,contrib});

    $('rInicial').textContent=m(sym,res.principal);
    $('rAportes').textContent=m(sym,res.totalContrib);
    $('rInteres').textContent=m(sym,res.totalInterest);
    $('rTotal').textContent=m(sym,res.total);
    $('resumen').textContent = `Capitalización ${$('freq').options[$('freq').selectedIndex].text.toLowerCase()} con aportes de ${m(sym,contrib)} por periodo durante ${years} año(s).`;

    renderBars(sym,{initial:res.principal,contrib:res.totalContrib,interest:res.totalInterest,label: years + (years==1?' año':' años')});

    const tb=$('tbody'); tb.innerHTML='';
    res.yearly.forEach(row=>{
      const tr=document.createElement('tr');
      tr.innerHTML=`<td>${row.year}</td><td>${m(sym,row.start)}</td><td>${m(sym,row.interest)}</td><td>${m(sym,row.contrib)}</td><td>${m(sym,row.end)}</td>`;
      tb.append(tr);
    });
  }

  function saveCfg(){ const cfg={sym:$('moneda').value, deposito:$('deposito').value, tasa:$('tasa').value, anios:$('anios').value, freq:$('freq').value, aporte:$('aporte').value, theme: document.body.classList.contains('light')?'light':'dark'}; localStorage.setItem('calcIC_cfg', JSON.stringify(cfg)); }
  function restoreCfg(){ const raw=localStorage.getItem('calcIC_cfg'); if(!raw) return; try{ const c=JSON.parse(raw); $('moneda').value=c.sym||'$'; $('deposito').value=c.deposito||0; $('tasa').value=c.tasa||0; $('anios').value=c.anios||0; $('freq').value=c.freq||'MONTHLY'; $('aporte').value=c.aporte||0; document.body.classList.toggle('light', c.theme==='light'); $('theme').checked=c.theme==='light'; }catch(e){} }

  ['moneda','deposito','tasa','anios','freq','aporte'].forEach(id=>document.getElementById(id).addEventListener('input', update));
  document.getElementById('guardar').addEventListener('click', ()=>{ saveCfg(); update(); });
  document.getElementById('ejemplo').addEventListener('click', ()=>{ $('moneda').value='$'; $('deposito').value=0; $('tasa').value=12; $('anios').value=20; $('freq').value='MONTHLY'; $('aporte').value=100; update(); });
  document.getElementById('theme').addEventListener('change', (e)=>{ document.body.classList.toggle('light', e.target.checked); saveCfg(); });

  restoreCfg(); update();
</script>
</body>
</html>
